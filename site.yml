---
- hosts: all
  roles:
  - common

- hosts: postgres
  roles:
  - postgres

- hosts: postgres
  sudo: True
  sudo_user: postgres
  tasks:
  - include: roles/postgres/tasks/setup_db.yml

- hosts: redis
  roles:
  - redis

- hosts: nginx
  roles:
  - nginx
  handlers:
  - name: reload nginx
    service: name=nginx state=reloaded

- hosts: varnish
  roles:
  - varnish

- hosts:
  - app
  - sidekiq
  roles:
  - hummingbird
  handlers:
  - name: reload monit
    service: name=monit state=reloaded
  - name: start unicorn
    monit: name=unicorn state=started
